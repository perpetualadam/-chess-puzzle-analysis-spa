<!DOCTYPE html>
<html>
<head>
  <title>Fresh Puzzle Verification Test</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
  <style>
    body { font-family: monospace; padding: 20px; background: #f5f5f5; }
    .pass { color: green; font-weight: bold; }
    .fail { color: red; font-weight: bold; }
    .puzzle { margin: 5px 0; padding: 8px; background: white; border-radius: 4px; }
    h1 { color: #333; }
    .summary { font-size: 20px; margin: 20px 0; padding: 15px; background: white; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>üîç Fresh Puzzle Verification Test (No Cache)</h1>
  <p><strong>Timestamp:</strong> <span id="timestamp"></span></p>
  <div id="results"></div>

  <script>
    document.getElementById('timestamp').textContent = new Date().toLocaleString();

    // FRESH puzzle data - Round 5 corrections
    const puzzles = [
      // WORKING PUZZLES ONLY (10 verified)
      { id: 'mate1-1', fen: '6k1/5ppp/8/8/8/8/5PPP/Q5K1 w - - 0 1', side: 'w', best: ['Qa8#'] },
      { id: 'mate-epaulette-1', fen: '5rkr/8/3Q4/8/8/8/1K6/8 w - - 0 1', side: 'w', best: ['Qg6#'] },
      { id: 'mate-smothered-1', fen: '6rk/6pp/8/6N1/8/8/8/6K1 w - - 0 1', side: 'w', best: ['Nf7#'] },
      { id: 'mate-arabian-1', fen: '7k/6pp/5N2/8/8/8/8/R6K w - - 0 1', side: 'w', best: ['Ra8#'] },
      { id: 'mate-arabian-2', fen: '6k1/5ppp/5N2/8/8/8/8/R6K w - - 0 1', side: 'w', best: ['Ra8#'] },
      { id: 'mate-anastasia-2', fen: '1r4k1/6pp/7N/8/8/8/8/4R2K w - - 0 1', side: 'w', best: ['Re8#'] },
      { id: 'mate-backrank-1', fen: '6k1/5ppp/8/8/8/8/4QPPP/4R1K1 w - - 0 1', side: 'w', best: ['Qe8#'] },
      { id: 'mate-backrank-2', fen: '4r1k1/5ppp/8/8/8/8/4qPPP/4R1K1 b - - 0 1', side: 'b', best: ['Qxe1#'] },
      { id: 'mate-dovetail-1', fen: '4k3/3p1p2/8/4Q3/8/8/8/4R1K1 w - - 0 1', side: 'w', best: ['Qe7#'] },
      { id: 'mate-dovetail-2', fen: '4r1k1/8/8/8/4q3/8/3P1P2/4K3 b - - 0 1', side: 'b', best: ['Qe2#'] }
    ];

    function testPuzzle(puzzle) {
      const chess = new Chess();
      try {
        chess.load(puzzle.fen);
        
        // Check turn
        if ((puzzle.side === 'w' && chess.turn() !== 'w') || (puzzle.side === 'b' && chess.turn() !== 'b')) {
          return { ok: false, error: 'Turn mismatch' };
        }
        
        // Play moves
        for (const san of puzzle.best) {
          const move = chess.move(san, { sloppy: true });
          if (!move) {
            return { ok: false, error: `Illegal move: ${san}` };
          }
        }
        
        // Check checkmate
        if (!chess.in_checkmate()) {
          return { ok: false, error: 'Not checkmate after moves' };
        }
        
        return { ok: true };
      } catch (e) {
        return { ok: false, error: e.message };
      }
    }

    const results = document.getElementById('results');
    let passed = 0;
    let failed = 0;
    const failures = [];

    puzzles.forEach(puzzle => {
      const result = testPuzzle(puzzle);
      const div = document.createElement('div');
      div.className = 'puzzle';
      
      if (result.ok) {
        div.innerHTML = `<span class="pass">‚úì ${puzzle.id}: PASS</span>`;
        passed++;
      } else {
        div.innerHTML = `<span class="fail">‚úó ${puzzle.id}: FAIL</span> - ${result.error}`;
        failed++;
        failures.push({ id: puzzle.id, error: result.error, fen: puzzle.fen });
      }
      
      results.appendChild(div);
    });

    const summary = document.createElement('div');
    summary.className = 'summary';
    summary.innerHTML = `
      <strong>Results: ${passed} passed, ${failed} failed out of ${puzzles.length} total</strong><br>
      ${failed === 0 ? '<span class="pass">üéâ ALL PUZZLES PASS!</span>' : '<span class="fail">‚ö† Some puzzles still failing</span>'}
    `;
    results.insertBefore(summary, results.firstChild);

    // Log failures for debugging
    if (failures.length > 0) {
      console.log('FAILING PUZZLES:', failures);
    }

    // Also log to page
    if (failures.length > 0) {
      const debugDiv = document.createElement('div');
      debugDiv.style.marginTop = '20px';
      debugDiv.style.padding = '15px';
      debugDiv.style.background = '#fff3cd';
      debugDiv.style.borderRadius = '8px';
      debugDiv.innerHTML = '<h3>Debug Info:</h3><pre>' + JSON.stringify(failures, null, 2) + '</pre>';
      results.appendChild(debugDiv);
    }
  </script>
</body>
</html>

